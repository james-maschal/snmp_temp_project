# SNMP_temp_project
This project is designed to collect inlet sensor temperature levels
for storage and querying for high temp IDFs. It references a list
of inlet sensor for each switch, updated every 30 days.
All data gets exported to a database for later retrieval.

NOTE - main.py will need to be updated with your directory for config file import.

## Stage 1 - Index Report
- The first thing this program does is check a file named "last_ran.ini" for the date of last index_report creation. If it has been more than 30 days, or if the file doesn't exist, It runs the index_report creation script.
- This script gathers an snmp sensor inventory table for every switch in the "interface_buildings" function from cisco_devices.py. It then filters for sensors labeled "nlet" (to find inlet sensors). It then further filters out sensors from Slots 2 or higher. The last section of the OID returned is used as the reference index for each sensor moving forward.(**See [ciscoEnvMonTemperatureStatusTable](https://snmp.cloudapps.cisco.com/Support/SNMP/do/BrowseOID.do?objectInput=1.3.6.1.4.1.9.9.13.1.3&translate=Translate)**)
- Everything is exported into index_report.json file for importing later.

## Stage 2 - Data Scraping
- This stage imports the index_report.json file and for each switch sensor it sends an snmp variable get for the inlet sensor temperature value. (**See [ciscoEnvMonTemperatureStatusValue](https://snmp.cloudapps.cisco.com/Support/SNMP/do/BrowseOID.do?objectInput=1.3.6.1.4.1.9.9.13.1.3.1.3&translate=Translate)**)
- All data is compiled and exported into the rx_levels.json file.

## Stage 3 - Database Export
- At this stage, the program connects to the database, and creates an index table for each switch. This contains the sensor index, and name (i.e "Slot 1 Temp:    Inlet") for reference. It then fills the table with data collected from index_report.json
- It then creates a secondary temp_table for each switch, containing the switch, index (referenced against the index table), temperature, and date (autogenerated on INSERT).
- A final table is then compiled from each switch's index/temp_level tables, containing switch, sensor, temperature, and date. an "id" column is autogenerated on INSERT, for use with Django's Web Framework. This table is created to make querying easier.
- Finally, the index and temp tables are deleted as they are no longer necessary.


